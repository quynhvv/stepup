/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.7.4
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(e,t){e.removeClass(t).addClass(t)},r=function(t,i){var r=this;r.$container=e(t),r.init(i),r.listen()};r.prototype={constructor:r,init:function(t){var i=this,r=i.$container;i.$input=r.find(".kv-editable-input"),i.$form=r.find(".kv-editable-form"),i.$value=r.find(".kv-editable-value"),i.$close=r.find(".kv-editable-close"),i.$popover=r.find(".kv-editable-popover"),i.$inline=r.find(".kv-editable-inline"),i.$btnSubmit=r.find("button.kv-editable-submit"),i.$btnReset=r.find("button.kv-editable-reset"),i.$loading=r.find(".kv-editable-loading"),i.$target=r.find(t.target),e.each(t,function(e,t){i[e]=t}),i.asPopover=1==i.asPopover||"true"===i.asPopover},toggle:function(e,t){var r=this,o=r.$value,n=r.$inline;return t=t||"fast",e?void(r.asPopover||o.fadeOut(t,function(){n.fadeIn(t),".kv-editable-button"===r.target&&i(r.$target,"kv-inline-open")})):void(r.asPopover?r.$popover.popoverX("hide"):n.fadeOut(t,function(){o.fadeIn(t),r.$target.removeClass("kv-inline-open")}))},refreshPopover:function(){var e=this;e.asPopover&&e.$popover.popoverX("refreshPosition")},listen:function(){var r,o,n=this,a=n.$form,l=n.$btnSubmit,s=n.$btnReset,v=a.parent(),u=n.$container,d=(n.$popover,n.$close),c=".kv-editable-button"===n.target?n.$target:n.$value,f=n.$inline,p=n.$loading,h=n.$input,b="",g="",m=h.closest(".field-"+h.attr("id")),k=h.closest(".kv-editable-parent"),$=m.find(".help-block"),y=n.displayValueConfig,C=a.find('input[name="hasEditable"]'),P=k.find(".kv-help-block"),E=a.data("yiiActiveForm"),j=t(m.attr("class"))||t($.attr("class"));r=function(r){j?(t(P.attr("class"))&&(P=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(k)),P.html(r)):($.html(r),i($,"kv-help-block")),i(k,"has-error"),p.hide(),v.removeClass("kv-editable-processing")},a.on("submit",function(e){e.preventDefault()}).on("keyup",function(e){13===e.which&&n.submitOnEnter&&l.trigger("click")}).on("reset",function(){setTimeout(function(){a.data("kvEditableSubmit",!1),j?(k.find(".help-block").remove(),k.removeClass("has-error")):(m.removeClass("has-error"),$.html(" ")),n.refreshPopover()},200)}),a.find("input, select").on("change",function(){n.refreshPopover(),u.trigger("editableChange",[h.val()])}),s.on("click",function(){C.val(0),setTimeout(function(){a[0].reset()},200),u.trigger("editableReset")}),d.on("click",function(){n.toggle(!1)}),c.on("click",function(){if(n.asPopover)return void n.toggle(!0);var e=!n.$inline.is(":visible");n.toggle(e)}),l.on("click",function(){var l=n.asPopover?v:f;i(l,"kv-editable-processing"),p.show(),C.val(1),a.find(".help-block").each(function(){e(this).html("")}),a.find(".has-error").removeClass("has-error"),a.find("input, select").each(function(){var t=e(this),i=t.val(),r=i;e.isArray(i)?r.push("-"):r+="-",t.val(r).trigger("blur").val(i).trigger("blur")}),o=e.extend({type:a.attr("method"),url:a.attr("action"),data:a.serialize(),dataType:"json",error:function(e,t,i){n.showAjaxErrors&&r(i),u.trigger("editableAjaxError",[e,t,i])},success:function(i){return b="",g=t(i.output)?h.val():i.output,n.refreshPopover(),t(i.message)?(t(P.attr("class"))||(m.removeClass("has-error"),P.html("").hide(),$.html("")),a.find(".help-block").each(function(){var i=e(this).text();b+=i?i.trim():"",t(b)||p.hide()}),t(b)?(p.hide(),t(g)?g=n.valueIfNull:void 0!==y[g]&&(g=y[g]),j?(k.find(".help-block").remove(),k.removeClass("has-error"),$.html(""),n.toggle(!1),n.$value.html(g)):(m.removeClass("has-error"),$.html(""),n.toggle(!1),n.$value.html(g),E&&(a.yiiActiveForm("destroy"),a.yiiActiveForm(E.attributes,E.settings))),u.trigger("editableSuccess",[h.val(),a,i])):u.trigger("editableError",[h.val(),a,i]),void l.removeClass("kv-editable-processing")):(r(i.message),void u.trigger("editableError",[h.val(),a,i]))}},n.ajaxSettings),setTimeout(function(){e.ajax(o),u.trigger("editableSubmit",[h.val(),a])},1e3)})}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var o=e(this),n=o.data("editable"),a="object"==typeof t&&t;n||(n=new r(this,e.extend({},e.fn.editable.defaults,a,e(this).data())),o.data("editable",n)),"string"==typeof t&&n[t].apply(n,i)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,asPopover:!0},e.fn.editable.Constructor=r}(window.jQuery);