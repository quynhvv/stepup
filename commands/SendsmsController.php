<?php

/**
 * @link http://www.yiiframework.com/
 * @copyright Copyright (c) 2008 Yii Software LLC
 * @license http://www.yiiframework.com/license/
 */

namespace app\commands;

use DateTime;
use MongoDate;
use Yii;
use yii\console\Controller;

use app\helpers\ArrayHelper;
use app\helpers\StringHelper;
use app\modules\sms\models\Sms;

class SendsmsController extends Controller {

    public function actionIndex() {
        $list = [
            '0985812321', '0983252556', '0985788876', '0915644761', '0962174093', '0943390573', '0904015747', '01235830292', '0978436699', '0945496514', '0985928766', '0978331828', '0989198126', '0983303050', '0989568453', '0913290355', '0904830989', '0973629669', '01694633133', '0966688889', '0913037160', '0947255116', '0906561429', '0983091405', '09096123483', '0945664486', '09044203889', '01627273784', '0942891991', '0979866822', '0983994659', '0962785555', '0906904290', '0983573069', '0912796281', '0904316663', '0913000228', '0988584468', '0982992080', '0965281199', '0936468089', '0915170789', '0933452011', '0915645678', '0936169395', '0979859336', '0904881982', '0966265422', '0917805162', '0936272202', '0989900086', '0967141112', '0989342246', '0968026399', '0934319777', '0983088128', '0943666970', '0936668925', '01689991999', '0978585878', '0913079780', '0978551030', '0983763733', '0986949088', '0906098008', '01648297192', '0976851988', '01687986879', '0984684824', '0912152916', '0904963369', '0936083536', '0914899842', '0967055879', '01242308656', '0962949567', '0974977688', '0988825923', '0919674216', '09766661196', '0972822296', '01296336972', '0916243838', '0984408927', '0918395395', '0906515988', '0976750828', '0985451286', '0936368485', '0966243246', '0932251987', '0946416636', '01649557758', '0987170650', '0983811386', '0979581099', '0915195098', '0923228886', '0912991409', '0987418811', '0939701922', '0122406698', '0989012738', '0919020814', '0913924042', '0944774117', '0938060311', '090384144', '0903589401', '0913790918', '0917406050', '0904132737', '0946459699', '0903407696', '0903278121', '0989084707', '01686086222', '0988264966', '0932322433', '0906163263', '0989264968', '0983841986', '0902899907', '0975099593', '0904311415', '0986730686', '0909667620', '0936195991', '0904179944', '0904315171', '0913111968', '0989828625', '0939961888', '09344512233', '0983626243', '0986368858', '0966191468', '01278997238', '0936848680', '0944530515', '0985684585', '0987834236', '0963626976', '0904246696', '0934356356', '0904009282', '0943461088', '0914849286', '0982570009', '0916423623', '0904961961', '0946676132', '0967306777', '01696993073', '0936363680', '0948513786', '0913005097', '09122866686', '01292295989', '0983000037', '0914335245', '0162716128', '0988069561', '0904009113', '0966012096', '0963790469', '0973493593', '0979402312', '0988090069', '0904655768', '01688741438', '0978259738', '0904338669', '0978138568', '01252821980', '0975521645', '01657699918', '01628758954', '0945989988', '0972272383', '0915688833', '09122443502', '0904646655', '0946042555', '0943346678', '0912640905',
        ];
        foreach ($list as $key => $phone) {
            echo $phone = StringHelper::asPhone($phone);
            echo ' - ';
            echo $code = substr($phone, -6);
            $message = 'Ma nhan The cao CT: CAO NGAY - TRUNG LON tai BiboMart cua a/c là: '.$code.'. Vui long giu lai tin nhan de nhan The cao may man. L/H: 1900555580 (nhanh 2)';
            
            $sendSms = new \app\modules\sms\helpers\SmsBrandname;
            $sendSms->phoneNumber = $phone;
            $sendSms->message = $message;
            $sendSms->type = 'CSKH';
            $sendSms->campaign = 'Cào ngay - Trúng lớn';
            $sendSms->sent();
            
            echo "\n";
        }
    }
    
    /**
     * Gui nhung tin nhan cua status = 0
     * Use: php yii sendsms/daily
     */
    public function actionDaily(){
        $stats = [];
        $limit = 100;
        for ($i = 0; $i < 10000; $i++) {
            $model = Sms::find()->where(['status' => 0])->limit($limit)->all();
            if($model) {
                foreach ($model as $sms) {
                    $sendSms = new \app\modules\sms\helpers\SmsBrandname;
                    $sendSms->model = $sms;
                    $sended = $sendSms->sent();
                    if (property_exists($sended, 'status'))
                        $stats[$sended->status] = ArrayHelper::getValue($stats, $sended->status, 0) + 1;
                }
            } else
                break;
        }
        echo "Thong ke gui sms:\n";
        foreach ($stats as $status => $value) {
            echo $status . ': ' . $value . "\n";
        }
    }
}
